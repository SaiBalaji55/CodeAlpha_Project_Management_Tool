<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Tool</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ===== CSS RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Modern Color Palette */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            
            /* Neutral Colors */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.5;
        }

        /* Hide all pages by default */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* ===== AUTH PAGE STYLES ===== */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 24px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-subtitle {
            color: var(--gray-500);
            font-size: 14px;
        }

        .auth-form {
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray-700);
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            color: var(--gray-800);
            transition: all var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-block {
            width: 100%;
        }

        .auth-footer {
            text-align: center;
            padding-top: 24px;
            border-top: 1px solid var(--gray-200);
            color: var(--gray-600);
        }

        .auth-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* ===== DASHBOARD STYLES ===== */
        .dashboard {
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid var(--gray-200);
            padding: 24px 0;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            margin-bottom: 32px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .nav-menu {
            padding: 16px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--gray-600);
            text-decoration: none;
            transition: all var(--transition-fast);
            border-left: 3px solid transparent;
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: inherit;
        }

        .nav-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--gray-50);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-text {
            font-weight: 500;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--primary);
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid var(--gray-200);
            margin-top: auto;
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 14px;
        }

        .user-email {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 24px;
            min-height: 100vh;
            background: var(--gray-50);
        }

        /* Topbar */
        .topbar {
            background: white;
            border-radius: var(--radius-lg);
            padding: 16px 24px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-md);
        }

        .search-box {
            flex: 1;
            position: relative;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .search-input:focus + .search-btn {
            display: block;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            color: var(--gray-600);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .notification-btn:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            border: 2px solid white;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            border-left: 4px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-title {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Recent Activity */
        .activity-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .view-all {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .view-all:hover {
            text-decoration: underline;
        }

        .activity-timeline {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px;
            border-radius: var(--radius-md);
            background: var(--gray-50);
            transition: all var(--transition-fast);
        }

        .activity-item:hover {
            background: var(--gray-100);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-content p {
            margin-bottom: 4px;
            color: var(--gray-800);
            line-height: 1.4;
        }

        .activity-content strong {
            color: var(--gray-900);
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform var(--transition-normal);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .modal-header h3 {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
        }

        .close-modal:hover {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--gray-200);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-outline:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        /* Notifications Panel */
        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 360px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-normal);
        }

        .notifications-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .mark-all-read {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }

        .notifications-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            transition: all var(--transition-fast);
        }

        .notification-item:hover {
            background: var(--gray-50);
        }

        .notification-item.unread {
            background: rgba(99, 102, 241, 0.05);
        }

        .notification-content p {
            margin-bottom: 4px;
            color: var(--gray-800);
            font-size: 14px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }

        .color-options {
            display: flex;
            gap: 8px;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: var(--gray-900);
            transform: scale(1.1);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: var(--success);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.toast-error {
            background: var(--danger);
        }

        .toast.toast-warning {
            background: var(--warning);
        }

        .toast-content {
            flex: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-left: 16px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform var(--transition-normal);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 24px;
            }
            
            .notifications-panel {
                width: 95%;
                right: 2.5%;
            }
            
            .menu-toggle {
                display: block !important;
                background: none;
                border: none;
                font-size: 20px;
                color: var(--gray-600);
                cursor: pointer;
            }
        }

        /* Projects Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .project-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            cursor: pointer;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .project-header {
            margin-bottom: 20px;
        }

        .project-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            margin-bottom: 12px;
        }

        .project-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .project-description {
            color: var(--gray-600);
            font-size: 14px;
            line-height: 1.5;
        }

        .project-progress {
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 4px;
            transition: width 1s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--gray-600);
        }

        .project-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 16px 0;
            border-top: 1px solid var(--gray-200);
            border-bottom: 1px solid var(--gray-200);
        }

        .project-stat {
            text-align: center;
        }

        .project-stat .stat-number {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .project-stat .stat-label {
            font-size: 12px;
            color: var(--gray-500);
        }

        .member-list {
            display: flex;
            align-items: center;
        }

        .member-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-700);
            font-size: 14px;
            font-weight: 600;
            margin-right: -8px;
            border: 2px solid white;
        }

        .member-avatar.more {
            background: var(--primary);
            color: white;
            font-size: 12px;
        }

        /* Task Board Styles */
        .task-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 24px;
        }

        .task-column {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--gray-200);
        }

        .column-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-count {
            background: var(--gray-200);
            color: var(--gray-700);
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 200px;
        }

        .task-item {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            cursor: move;
            transition: all var(--transition-fast);
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .task-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 14px;
            flex: 1;
        }

        .task-priority {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: var(--danger);
            color: white;
        }

        .priority-medium {
            background: var(--warning);
            color: var(--gray-900);
        }

        .priority-low {
            background: var(--success);
            color: white;
        }

        .task-description {
            color: var(--gray-600);
            font-size: 12px;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .task-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            color: var(--gray-500);
        }

        .task-project {
            background: var(--gray-100);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .task-due {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Calendar Styles */
        .calendar-container {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 32px;
        }

        #calendar {
            margin-top: 20px;
        }

        .fc {
            font-family: 'Inter', sans-serif;
        }

        .fc-toolbar-title {
            font-size: 1.5rem !important;
            font-weight: 600;
        }

        .fc-button {
            background: var(--primary) !important;
            border: none !important;
            padding: 8px 16px !important;
            border-radius: var(--radius-md) !important;
        }

        .fc-button:hover {
            background: var(--primary-dark) !important;
        }

        .fc-daygrid-event {
            border-radius: var(--radius-sm) !important;
            padding: 4px 8px !important;
        }

        .fc-event-title {
            font-weight: 500 !important;
        }

        /* ===== ANALYTICS PAGE STYLES ===== */
        .analytics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .analytics-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .analytics-card.wide {
            grid-column: span 2;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-top: 20px;
        }

        /* ===== SETTINGS PAGE STYLES ===== */
        .settings-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .settings-sidebar {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            height: fit-content;
        }

        .settings-nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .settings-nav-item {
            padding: 12px 16px;
            color: var(--gray-600);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .settings-nav-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .settings-nav-item.active {
            background: var(--gray-50);
            color: var(--primary);
            font-weight: 500;
        }

        .settings-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-md);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        .settings-section h3 {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-200);
            color: var(--gray-900);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .theme-option {
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .theme-option:hover {
            border-color: var(--primary);
        }

        .theme-option.active {
            border-color: var(--primary);
            background: var(--gray-50);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
        }

        .theme-light .theme-preview {
            background: linear-gradient(135deg, var(--gray-50), white);
        }

        .theme-dark .theme-preview {
            background: linear-gradient(135deg, var(--gray-800), var(--gray-900));
        }

        .theme-system .theme-preview {
            background: linear-gradient(135deg, var(--gray-50) 50%, var(--gray-800) 50%);
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

         /* ===== TEAM PAGE STYLES ===== */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .team-member-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all var(--transition-normal);
        }

        .team-member-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .member-avatar-lg {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 600;
            margin: 0 auto 16px;
        }

        .member-role {
            display: inline-block;
            background: var(--gray-100);
            color: var(--gray-600);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .member-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray-500);
        }
        /* Search Results */
        .search-results {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 32px;
        }

        .search-results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .search-results-count {
            color: var(--gray-500);
            font-size: 14px;
        }

        .search-result-item {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            transition: all var(--transition-fast);
        }

        .search-result-item:hover {
            background: var(--gray-50);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-type {
            display: inline-block;
            background: var(--gray-100);
            color: var(--gray-600);
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 8px;
            text-transform: uppercase;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--gray-900);
            margin: 4px 0;
        }

        .search-result-description {
            color: var(--gray-600);
            font-size: 12px;
            margin-bottom: 8px;
        }

        .search-result-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 11px;
            color: var(--gray-500);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            color: var(--gray-300);
            margin-bottom: 16px;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        .empty-state-description {
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* Task Status Colors */
        .status-todo .column-title { color: var(--gray-600); }
        .status-in-progress .column-title { color: var(--primary); }
        .status-review .column-title { color: var(--warning); }
        .status-completed .column-title { color: var(--success); }

        .status-todo .task-count { background: var(--gray-200); color: var(--gray-600); }
        .status-in-progress .task-count { background: var(--primary-light); color: var(--primary-dark); }
        .status-review .task-count { background: #fef3c7; color: #d97706; }
        .status-completed .task-count { background: #d1fae5; color: #059669; }
    </style>
</head>
<body>
    <!-- Auth Page -->
    <div id="authPage" class="page active">
        <div class="auth-page">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-logo">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <h1 class="auth-title" id="loginTitle">Welcome Back</h1>
                    <h1 class="auth-title" id="registerTitle" style="display: none;">Create Account</h1>
                    <p class="auth-subtitle">Sign in to manage your projects</p>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                </form>

                <!-- Register Form -->
                <form id="registerForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label for="regName" class="form-label">Full Name</label>
                        <input type="text" id="regName" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail" class="form-label">Email</label>
                        <input type="email" id="regEmail" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword" class="form-label">Password</label>
                        <input type="password" id="regPassword" class="form-control" placeholder="Create a password (min 6 chars)" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                </form>

                <div class="auth-footer">
                    <p>
                        <span id="loginText">Don't have an account? </span>
                        <span id="registerText" style="display: none;">Already have an account? </span>
                        <a href="#" class="auth-link" id="showRegister">Sign Up</a>
                        <a href="#" class="auth-link" id="showLogin" style="display: none;">Sign In</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
        <div class="dashboard">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item active" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('projectsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <span class="nav-text">Projects</span>
                        <span class="nav-badge" id="projectsBadge">12</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('tasksPage')">
                        <div class="nav-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <span class="nav-text">Tasks</span>
                        <span class="nav-badge" id="tasksBadge">24</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('calendarPage')">
                        <div class="nav-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <span class="nav-text">Calendar</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('teamPage')">
                        <div class="nav-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="nav-text">Team</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('analyticsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="nav-text">Analytics</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('settingsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span class="nav-text">Settings</span>
                    </button>
                </nav>
                
                <div class="sidebar-footer">
                    <div class="user-card">
                        <div class="user-avatar" id="userAvatar">JD</div>
                        <div class="user-details">
                            <div class="user-name" id="userName">John Doe</div>
                            <div class="user-email" id="userEmail">john@example.com</div>
                        </div>
                        <button class="logout-btn" id="logoutBtn" style="background: none; border: none; color: var(--gray-500); cursor: pointer; padding: 8px;">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Topbar -->
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search projects, tasks, or team members..." onkeyup="handleSearch(event)">
                        <button class="search-btn" onclick="performSearch()">Search</button>
                    </div>
                    
                    <div class="user-menu">
                        <button class="notification-btn" id="notificationsBtn" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge"></span>
                        </button>
                        
                        <button id="newTaskBtn" class="btn btn-primary" onclick="showModal('newTaskModal')">
                            <i class="fas fa-plus"></i> New Task
                        </button>
                    </div>
                </header>

                <!-- Search Results (Hidden by default) -->
                <div id="searchResults" class="search-results" style="display: none;">
                    <div class="search-results-header">
                        <h3>Search Results</h3>
                        <span class="search-results-count" id="searchResultsCount">0 results</span>
                    </div>
                    <div id="searchResultsList"></div>
                </div>

                <!-- Stats Overview -->
                <section class="stats-overview">
                    <h2 style="margin-bottom: 20px; font-size: 24px; color: var(--gray-900);">Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3 class="stat-title">Total Projects</h3>
                                <div class="stat-icon">
                                    <i class="fas fa-folder"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalProjects">12</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>3 new this month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="border-left-color: var(--success);">
                            <div class="stat-header">
                                <h3 class="stat-title">Completed Tasks</h3>
                                <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), var(--secondary-dark));">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="completedTasks">156</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>18% from last week</span>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="border-left-color: var(--warning);">
                            <div class="stat-header">
                                <h3 class="stat-title">Pending Tasks</h3>
                                <div class="stat-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="pendingTasks">24</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>4 overdue</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3 class="stat-title">Team Members</h3>
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="teamMembers">8</div>
                            <div class="stat-change positive">
                                <i class="fas fa-user-plus"></i>
                                <span>2 new members</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recent Projects -->
                <section class="projects-section">
                    <div class="section-header">
                        <h2>Recent Projects</h2>
                        <a href="#" class="view-all" onclick="showPage('projectsPage'); return false;">View All <i class="fas fa-arrow-right"></i></a>
                    </div>
                    
                    <div class="projects-grid" id="recentProjectsGrid">
                        <!-- Projects will be loaded by JavaScript -->
                    </div>
                </section>

                <!-- Recent Activity -->
                <section class="activity-section">
                    <div class="section-header">
                        <h2>Recent Activity</h2>
                        <a href="#" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
                    </div>
                    
                    <div class="activity-timeline" id="activityTimeline">
                        <!-- Activity items will be loaded here -->
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Projects Page -->
    <div id="projectsPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item active" onclick="showPage('projectsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <span class="nav-text">Projects</span>
                        <span class="nav-badge" id="projectsBadge2">12</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('tasksPage')">
                        <div class="nav-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <span class="nav-text">Tasks</span>
                        <span class="nav-badge" id="tasksBadge2">24</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search projects...">
                    </div>
                    <button class="btn btn-primary" onclick="showModal('newProjectModal')">
                        <i class="fas fa-plus"></i> New Project
                    </button>
                </header>

                <div class="projects-grid" id="allProjectsGrid">
                    <!-- All projects will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- Tasks Page -->
    <div id="tasksPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('projectsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <span class="nav-text">Projects</span>
                        <span class="nav-badge" id="projectsBadge3">12</span>
                    </button>
                    
                    <button class="nav-item active" onclick="showPage('tasksPage')">
                        <div class="nav-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <span class="nav-text">Tasks</span>
                        <span class="nav-badge" id="tasksBadge3">24</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search tasks...">
                    </div>
                    <button class="btn btn-primary" onclick="showModal('newTaskModal')">
                        <i class="fas fa-plus"></i> New Task
                    </button>
                </header>

                <!-- Task Board -->
                <div class="task-board">
                    <!-- To Do Column -->
                    <div class="task-column status-todo" id="todoColumn">
                        <div class="column-header">
                            <div class="column-title">
                                <i class="fas fa-circle" style="color: var(--gray-400);"></i>
                                To Do
                                <span class="task-count" id="todoCount">0</span>
                            </div>
                            <button class="btn btn-sm" onclick="addTaskToColumn('todo')" style="background: none; border: none; color: var(--gray-400); font-size: 20px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="task-list" id="todoList" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Todo tasks will be loaded here -->
                        </div>
                    </div>

                    <!-- In Progress Column -->
                    <div class="task-column status-in-progress" id="inProgressColumn">
                        <div class="column-header">
                            <div class="column-title">
                                <i class="fas fa-circle" style="color: var(--primary);"></i>
                                In Progress
                                <span class="task-count" id="inProgressCount">0</span>
                            </div>
                            <button class="btn btn-sm" onclick="addTaskToColumn('in-progress')" style="background: none; border: none; color: var(--gray-400); font-size: 20px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="task-list" id="inProgressList" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- In Progress tasks will be loaded here -->
                        </div>
                    </div>

                    <!-- Review Column -->
                    <div class="task-column status-review" id="reviewColumn">
                        <div class="column-header">
                            <div class="column-title">
                                <i class="fas fa-circle" style="color: var(--warning);"></i>
                                Review
                                <span class="task-count" id="reviewCount">0</span>
                            </div>
                            <button class="btn btn-sm" onclick="addTaskToColumn('review')" style="background: none; border: none; color: var(--gray-400); font-size: 20px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="task-list" id="reviewList" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Review tasks will be loaded here -->
                        </div>
                    </div>

                    <!-- Completed Column -->
                    <div class="task-column status-completed" id="completedColumn">
                        <div class="column-header">
                            <div class="column-title">
                                <i class="fas fa-circle" style="color: var(--success);"></i>
                                Completed
                                <span class="task-count" id="completedCount">0</span>
                            </div>
                            <button class="btn btn-sm" onclick="addTaskToColumn('completed')" style="background: none; border: none; color: var(--gray-400); font-size: 20px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="task-list" id="completedList" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <!-- Completed tasks will be loaded here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Calendar Page -->
    <div id="calendarPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('projectsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <span class="nav-text">Projects</span>
                        <span class="nav-badge">12</span>
                    </button>
                    
                    <button class="nav-item active" onclick="showPage('calendarPage')">
                        <div class="nav-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <span class="nav-text">Calendar</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 style="margin: 0; font-size: 24px;">Calendar</h2>
                    <button class="btn btn-primary" onclick="showModal('newTaskModal')">
                        <i class="fas fa-plus"></i> Add Event
                    </button>
                </header>

                <div class="calendar-container">
                    <div id="calendar"></div>
                </div>
            </main>
        </div>
    </div>
    <!-- Team Page -->
    <div id="teamPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item active" onclick="showPage('teamPage')">
                        <div class="nav-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <span class="nav-text">Team</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 style="margin: 0; font-size: 24px;">Team Members</h2>
                    <button class="btn btn-primary" onclick="showModal('addMemberModal')">
                        <i class="fas fa-user-plus"></i> Add Member
                    </button>
                </header>

                <div class="team-grid" id="teamMembersGrid">
                    <!-- Team members will be loaded here -->
                </div>

                <!-- Team Statistics -->
                <div class="analytics-card" style="margin-top: 32px;">
                    <h3>Team Statistics</h3>
                    <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-top: 20px;">
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3 class="stat-title">Total Members</h3>
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="totalMembers">8</div>
                            <div class="stat-change positive">
                                <i class="fas fa-user-plus"></i>
                                <span>2 new this month</span>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="border-left-color: var(--success);">
                            <div class="stat-header">
                                <h3 class="stat-title">Active Members</h3>
                                <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), var(--secondary-dark));">
                                    <i class="fas fa-user-check"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="activeMembers">7</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>All members active</span>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="border-left-color: var(--warning);">
                            <div class="stat-header">
                                <h3 class="stat-title">Avg. Tasks</h3>
                                <div class="stat-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                                    <i class="fas fa-tasks"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="avgTasks">12</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>3 from last week</span>
                            </div>
                        </div>
                        
                        <div class="stat-card" style="border-left-color: var(--primary);">
                            <div class="stat-header">
                                <h3 class="stat-title">Completion Rate</h3>
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="completionRate">85%</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>5% improvement</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Analytics Page -->
    <div id="analyticsPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item" onclick="showPage('analyticsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <span class="nav-text">Analytics</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 style="margin: 0; font-size: 24px;">Analytics Dashboard</h2>
                    <div class="date-range">
                        <select id="analyticsPeriod" class="form-control" style="width: 200px;" onchange="updateAnalytics()">
                            <option value="7days">Last 7 Days</option>
                            <option value="30days" selected>Last 30 Days</option>
                            <option value="90days">Last 90 Days</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                </header>

                <div class="analytics-container">
                    <!-- Task Completion Chart -->
                    <div class="analytics-card wide">
                        <h3>Task Completion Trend</h3>
                        <div class="chart-container">
                            <canvas id="taskCompletionChart" height="450" style="display: block; box-sizing: border-box; height: 300px; width: 630px;" width="945"></canvas>
                        </div>
                    </div>

                    <!-- Project Progress -->
                    <div class="analytics-card">
                        <h3>Project Progress</h3>
                        <div class="chart-container">
                            <canvas id="projectProgressChart"></canvas>
                        </div>
                    </div>

                    <!-- Team Performance -->
                    <div class="analytics-card">
                        <h3>Team Performance</h3>
                        <div class="chart-container">
                            <canvas id="teamPerformanceChart"></canvas>
                        </div>
                    </div>

                    <!-- Task Distribution -->
                    <div class="analytics-card wide">
                        <h3>Task Distribution</h3>
                        <div class="chart-container">
                            <canvas id="taskDistributionChart"></canvas>
                        </div>
                    </div>

                    <!-- Productivity Metrics -->
                    <div class="analytics-card">
                        <h3>Productivity Metrics</h3>
                        <div id="productivityMetrics">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="analytics-card">
                        <h3>Top Performers</h3>
                        <div id="topPerformers">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="page">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600); margin-bottom: 16px;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showPage('dashboardPage'); return false;">
                        <div class="logo-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <span class="logo-text">ProjectFlow</span>
                    </a>
                </div>
                
                <nav class="nav-menu">
                    <button class="nav-item" onclick="showPage('dashboardPage')">
                        <div class="nav-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    
                    <button class="nav-item active" onclick="showPage('settingsPage')">
                        <div class="nav-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span class="nav-text">Settings</span>
                    </button>
                </nav>
            </aside>

            <main class="main-content">
                <header class="topbar">
                    <button class="menu-toggle" onclick="toggleSidebar()" style="display: none; background: none; border: none; font-size: 20px; color: var(--gray-600);">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 style="margin: 0; font-size: 24px;">Settings</h2>
                </header>

                <div class="settings-container">
                    <!-- Settings Sidebar -->
                    <div class="settings-sidebar">
                        <nav class="settings-nav">
                            <a class="settings-nav-item active" onclick="showSettingsSection('profile')">
                                <i class="fas fa-user"></i> Profile
                            </a>
                            <a class="settings-nav-item" onclick="showSettingsSection('account')">
                                <i class="fas fa-key"></i> Account
                            </a>
                            <a class="settings-nav-item" onclick="showSettingsSection('notifications')">
                                <i class="fas fa-bell"></i> Notifications
                            </a>
                            <a class="settings-nav-item" onclick="showSettingsSection('appearance')">
                                <i class="fas fa-palette"></i> Appearance
                            </a>
                            <a class="settings-nav-item" onclick="showSettingsSection('privacy')">
                                <i class="fas fa-shield-alt"></i> Privacy
                            </a>
                            <a class="settings-nav-item" onclick="showSettingsSection('integrations')">
                                <i class="fas fa-plug"></i> Integrations
                            </a>
                        </nav>
                    </div>

                    <!-- Settings Content -->
                    <div class="settings-content">
                        <!-- Profile Section -->
                        <div id="profileSection" class="settings-section active">
                            <h3>Profile Settings</h3>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label for="profileName" class="form-label">Full Name</label>
                                    <input type="text" id="profileName" class="form-control" value="John Doe">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileEmail" class="form-label">Email Address</label>
                                    <input type="email" id="profileEmail" class="form-control" value="john@example.com">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileTitle" class="form-label">Job Title</label>
                                    <input type="text" id="profileTitle" class="form-control" value="Project Manager">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profileBio" class="form-label">Bio</label>
                                    <textarea id="profileBio" class="form-control" rows="4">Experienced project manager with 5+ years in software development. Passionate about agile methodologies and team collaboration.</textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Profile Picture</label>
                                    <div style="display: flex; align-items: center; gap: 20px;">
                                        <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;">JD</div>
                                        <div>
                                            <button type="button" class="btn btn-outline btn-sm">
                                                <i class="fas fa-upload"></i> Upload New
                                            </button>
                                            <button type="button" class="btn btn-outline btn-sm" style="margin-left: 8px;">
                                                <i class="fas fa-trash"></i> Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                    <button type="button" class="btn btn-outline" style="margin-left: 12px;">Cancel</button>
                                </div>
                            </form>
                        </div>

                        <!-- Account Section -->
                        <div id="accountSection" class="settings-section">
                            <h3>Account Security</h3>
                            <form id="accountForm">
                                <div class="form-group">
                                    <label for="currentPassword" class="form-label">Current Password</label>
                                    <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input type="password" id="newPassword" class="form-control" placeholder="Enter new password">
                                    <small style="color: var(--gray-500); font-size: 12px; display: block; margin-top: 4px;">Minimum 8 characters with letters and numbers</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Two-Factor Authentication</label>
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <p style="margin: 0; color: var(--gray-600);">Add an extra layer of security to your account</p>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="twoFactorToggle">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Update Password</button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 48px; padding-top: 24px; border-top: 2px solid var(--gray-200);">
                                <h4 style="color: var(--danger); margin-bottom: 16px;">Danger Zone</h4>
                                <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                    <p style="margin-bottom: 16px; color: var(--gray-700);">Once you delete your account, there is no going back. Please be certain.</p>
                                    <button type="button" class="btn btn-danger" onclick="showModal('deleteAccountModal')">
                                        <i class="fas fa-trash"></i> Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications Section -->
                        <div id="notificationsSection" class="settings-section">
                            <h3>Notification Preferences</h3>
                            <form id="notificationsForm">
                                <div class="form-group">
                                    <label class="form-label">Email Notifications</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Task Assignments</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Get notified when you're assigned to a task</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="emailTaskAssignments" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Task Updates</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Get notified when tasks are updated</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="emailTaskUpdates" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Comments</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Get notified on new comments</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="emailComments" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Project Updates</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Get notified about project changes</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="emailProjectUpdates">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Push Notifications</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Desktop Notifications</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Show desktop notifications</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="pushDesktop" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Sound Alerts</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Play sound for notifications</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="pushSound">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                                    <button type="button" class="btn btn-outline" style="margin-left: 12px;" onclick="resetNotificationSettings()">Reset to Default</button>
                                </div>
                            </form>
                        </div>

                        <!-- Appearance Section -->
                        <div id="appearanceSection" class="settings-section">
                            <h3>Appearance Settings</h3>
                            <form id="appearanceForm">
                                <div class="form-group">
                                    <label class="form-label">Theme</label>
                                    <div class="theme-options">
                                        <div class="theme-option theme-light active" onclick="selectTheme('light')">
                                            <div class="theme-preview"></div>
                                            <p style="font-weight: 500; margin: 8px 0 4px;">Light</p>
                                            <p style="color: var(--gray-500); font-size: 12px;">Bright theme</p>
                                        </div>
                                        
                                        <div class="theme-option theme-dark" onclick="selectTheme('dark')">
                                            <div class="theme-preview"></div>
                                            <p style="font-weight: 500; margin: 8px 0 4px;">Dark</p>
                                            <p style="color: var(--gray-500); font-size: 12px;">Dark theme</p>
                                        </div>
                                        
                                        <div class="theme-option theme-system" onclick="selectTheme('system')">
                                            <div class="theme-preview"></div>
                                            <p style="font-weight: 500; margin: 8px 0 4px;">System</p>
                                            <p style="color: var(--gray-500); font-size: 12px;">Follow OS</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Color Scheme</label>
                                    <div class="color-picker">
                                        <div class="color-options" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
                                            <div class="color-option active" style="background: #6366f1;" data-color="#6366f1" onclick="selectColor(this, 'primaryColor')"></div>
                                            <div class="color-option" style="background: #10b981;" data-color="#10b981" onclick="selectColor(this, 'primaryColor')"></div>
                                            <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor(this, 'primaryColor')"></div>
                                            <div class="color-option" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor(this, 'primaryColor')"></div>
                                            <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor(this, 'primaryColor')"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Layout Density</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Compact View</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Show more content in less space</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="compactView">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                    <button type="button" class="btn btn-outline" style="margin-left: 12px;" onclick="resetAppearanceSettings()">Reset to Default</button>
                                </div>
                            </form>
                        </div>

                        <!-- Privacy Section -->
                        <div id="privacySection" class="settings-section">
                            <h3>Privacy Settings</h3>
                            <form id="privacyForm">
                                <div class="form-group">
                                    <label class="form-label">Data Collection</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Usage Analytics</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Help us improve by sharing usage data</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="usageAnalytics" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Crash Reports</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Send crash reports automatically</p>
                                            </div>
                                            <label class="switch">
                                                <input type="checkbox" id="crashReports" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Profile Visibility</label>
                                    <select id="profileVisibility" class="form-control">
                                        <option value="public">Public - Anyone can see</option>
                                        <option value="team" selected>Team - Only team members</option>
                                        <option value="private">Private - Only you</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Activity Sharing</label>
                                    <select id="activitySharing" class="form-control">
                                        <option value="all">Share all activity</option>
                                        <option value="limited" selected>Share limited activity</option>
                                        <option value="none">Don't share activity</option>
                                    </select>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 48px; padding-top: 24px; border-top: 2px solid var(--gray-200);">
                                <h4 style="color: var(--gray-800); margin-bottom: 16px;">Data Management</h4>
                                <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                    <p style="margin-bottom: 16px; color: var(--gray-700);">Download or delete your personal data</p>
                                    <button type="button" class="btn btn-outline" onclick="downloadData()" style="margin-right: 12px;">
                                        <i class="fas fa-download"></i> Download Data
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="clearData()">
                                        <i class="fas fa-trash"></i> Clear Data
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Integrations Section -->
                        <div id="integrationsSection" class="settings-section">
                            <h3>Integrations</h3>
                            <form id="integrationsForm">
                                <div class="form-group">
                                    <label class="form-label">Connected Services</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <!-- Google Drive -->
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--gray-200);">
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <div style="width: 40px; height: 40px; background: #4285F4; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                                                    <i class="fab fa-google"></i>
                                                </div>
                                                <div>
                                                    <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Google Drive</p>
                                                    <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Connected</p>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="disconnectService('google')">
                                                Disconnect
                                            </button>
                                        </div>
                                        
                                        <!-- Slack -->
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--gray-200);">
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <div style="width: 40px; height: 40px; background: #4A154B; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                                                    <i class="fab fa-slack"></i>
                                                </div>
                                                <div>
                                                    <p style="font-weight: 500; margin: 0; color: var(--gray-800);">Slack</p>
                                                    <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Connected</p>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="disconnectService('slack')">
                                                Disconnect
                                            </button>
                                        </div>
                                        
                                        <!-- GitHub -->
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <div style="width: 40px; height: 40px; background: #333; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white;">
                                                    <i class="fab fa-github"></i>
                                                </div>
                                                <div>
                                                    <p style="font-weight: 500; margin: 0; color: var(--gray-800);">GitHub</p>
                                                    <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">Not connected</p>
                                                </div>
                                            </div>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="connectService('github')">
                                                Connect
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">API Access</label>
                                    <div style="background: var(--gray-50); padding: 20px; border-radius: var(--radius-md);">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <div>
                                                <p style="font-weight: 500; margin: 0; color: var(--gray-800);">API Key</p>
                                                <p style="margin: 4px 0 0; color: var(--gray-600); font-size: 14px;">For accessing ProjectFlow API</p>
                                            </div>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="generateApiKey()">
                                                Generate Key
                                            </button>
                                        </div>
                                        
                                        <div id="apiKeyContainer" style="display: none;">
                                            <div style="background: white; padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--gray-300); margin-top: 12px;">
                                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                                    <code id="apiKey" style="font-family: monospace; color: var(--gray-700);">sk_live_***************</code>
                                                    <button type="button" class="btn btn-outline btn-sm" onclick="copyApiKey()">
                                                        <i class="fas fa-copy"></i> Copy
                                                    </button>
                                                </div>
                                                <p style="margin: 8px 0 0; color: var(--danger); font-size: 12px;">
                                                    <i class="fas fa-exclamation-triangle"></i> Keep this key secret
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 32px;">
                                    <button type="submit" class="btn btn-primary">Save Integration Settings</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== MODALS ===== -->
    
    <!-- New Project Modal -->
    <div class="modal" id="newProjectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Project</h3>
                <button class="close-modal" onclick="hideModal('newProjectModal')">&times;</button>
            </div>
            <form id="projectForm" onsubmit="createProject(event); return false;">
                <div class="form-group">
                    <label for="projectName" class="form-label">Project Name *</label>
                    <input type="text" id="projectName" class="form-control" placeholder="Enter project name" required>
                </div>
                
                <div class="form-group">
                    <label for="projectDescription" class="form-label">Description</label>
                    <textarea id="projectDescription" class="form-control" placeholder="Describe your project..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Color</label>
                    <div class="color-picker">
                        <input type="color" id="projectColor" value="#6366f1" style="width: 50px; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                        <div class="color-options">
                            <div class="color-option active" style="background: #6366f1;" data-color="#6366f1" onclick="selectColor(this, 'projectColor')"></div>
                            <div class="color-option" style="background: #10b981;" data-color="#10b981" onclick="selectColor(this, 'projectColor')"></div>
                            <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor(this, 'projectColor')"></div>
                            <div class="color-option" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor(this, 'projectColor')"></div>
                            <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor(this, 'projectColor')"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="projectDeadline" class="form-label">Deadline</label>
                    <input type="date" id="projectDeadline" class="form-control">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="hideModal('newProjectModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Task Modal -->
    <div class="modal" id="newTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Task</h3>
                <button class="close-modal" onclick="hideModal('newTaskModal')">&times;</button>
            </div>
            <form id="taskForm" onsubmit="createTask(event); return false;">
                <div class="form-group">
                    <label for="taskTitle" class="form-label">Task Title *</label>
                    <input type="text" id="taskTitle" class="form-control" placeholder="Enter task title" required>
                </div>
                
                <div class="form-group">
                    <label for="taskDescription" class="form-label">Description</label>
                    <textarea id="taskDescription" class="form-control" placeholder="Describe the task..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="taskProjectSelect" class="form-label">Project</label>
                    <select id="taskProjectSelect" class="form-control">
                        <option value="">Select Project</option>
                        <!-- Projects will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="taskPriority" class="form-label">Priority</label>
                    <select id="taskPriority" class="form-control">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="taskStatus" class="form-label">Status</label>
                    <select id="taskStatus" class="form-control">
                        <option value="todo">To Do</option>
                        <option value="in-progress">In Progress</option>
                        <option value="review">Review</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="taskDeadline" class="form-label">Deadline</label>
                    <input type="date" id="taskDeadline" class="form-control">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="hideModal('newTaskModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskDetailTitle">Task Details</h3>
                <button class="close-modal" onclick="hideModal('taskDetailModal')">&times;</button>
            </div>
            <div id="taskDetailContent">
                <!-- Task details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="panel-header">
            <h3>Notifications</h3>
            <button class="mark-all-read" onclick="markAllNotificationsAsRead()">Mark all as read</button>
        </div>
        <div class="notifications-list" id="notificationsList">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <!-- Add Team Member Modal -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Team Member</h3>
                <button class="close-modal" onclick="hideModal('addMemberModal')">&times;</button>
            </div>
            <form id="addMemberForm" onsubmit="addTeamMember(event); return false;">
                <div class="form-group">
                    <label for="memberName" class="form-label">Full Name *</label>
                    <input type="text" id="memberName" class="form-control" placeholder="Enter full name" required>
                </div>
                
                <div class="form-group">
                    <label for="memberEmail" class="form-label">Email Address *</label>
                    <input type="email" id="memberEmail" class="form-control" placeholder="Enter email address" required>
                </div>
                
                <div class="form-group">
                    <label for="memberRole" class="form-label">Role *</label>
                    <select id="memberRole" class="form-control" required>
                        <option value="">Select Role</option>
                        <option value="project-manager">Project Manager</option>
                        <option value="developer">Developer</option>
                        <option value="designer">Designer</option>
                        <option value="qa">Quality Assurance</option>
                        <option value="product-owner">Product Owner</option>
                        <option value="scrum-master">Scrum Master</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="memberPermissions" class="form-label">Permissions</label>
                    <select id="memberPermissions" class="form-control">
                        <option value="full">Full Access</option>
                        <option value="edit">Can Edit</option>
                        <option value="view" selected>View Only</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="hideModal('addMemberModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Member</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal" id="deleteAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Account</h3>
                <button class="close-modal" onclick="hideModal('deleteAccountModal')">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="width: 80px; height: 80px; background: var(--danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; color: white; font-size: 32px;">
                        <i class="fas fa-exclamation"></i>
                    </div>
                    <h3 style="color: var(--danger); margin-bottom: 8px;">Warning</h3>
                    <p style="color: var(--gray-600);">This action cannot be undone. All your data will be permanently deleted.</p>
                </div>
                
                <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius-md); margin-bottom: 24px;">
                    <p style="font-weight: 500; margin-bottom: 8px; color: var(--gray-800);">What will be deleted:</p>
                    <ul style="color: var(--gray-600); padding-left: 20px; margin: 0;">
                        <li>All your projects and tasks</li>
                        <li>Your profile information</li>
                        <li>Team memberships</li>
                        <li>Activity history</li>
                        <li>Settings and preferences</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="confirmDelete" class="form-label">Type "DELETE" to confirm</label>
                    <input type="text" id="confirmDelete" class="form-control" placeholder="Type DELETE here">
                </div>
                
                <div style="margin-top: 32px; display: flex; gap: 12px;">
                    <button type="button" class="btn btn-danger" style="flex: 1;" onclick="deleteAccount()" id="deleteAccountBtn" disabled>
                        <i class="fas fa-trash"></i> Delete Account
                    </button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('deleteAccountModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    
    <script>
         const API_BASE_URL = "http://localhost:3000/api";
        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let projects = [];
        let tasks = [];
        let teamMembers = [];
        let activities = [];
        let notifications = [];
        let analytics = {};
        let calendar = null;
        let searchTimeout = null;
        let analyticsCharts = {};

        // ===== PAGE MANAGEMENT =====
        function showPage(pageId) {
            // Hide all pages
            if (pageId !== 'authPage' && !currentUser) {
                showPage('authPage');
                return;
            }
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
            }
            
            // Update navigation
            updateNavigation(pageId);
            
            // Initialize specific page features
            if (pageId === 'dashboardPage') {
                updateDashboard();
            } else if (pageId === 'tasksPage') {
                renderTaskBoard();
            } else if (pageId === 'calendarPage') {
                initCalendar();
            } else if (pageId === 'projectsPage') {
                renderAllProjects();
            } else if (pageId === 'teamPage') {
                renderTeamMembers();
            } else if (pageId === 'analyticsPage') {
                initAnalytics();
            } else if (pageId === 'settingsPage') {
                initSettings();
            }
        }

        function updateNavigation(activePage) {
            // Update sidebar navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Update settings navigation
            document.querySelectorAll('.settings-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to current page nav item
            const navItem = document.querySelector(`[onclick*="${activePage}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.classList.toggle('active');
            }
        }

        // ===== MODAL MANAGEMENT =====
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Initialize modal data if needed
                if (modalId === 'newTaskModal') {
                    populateProjectSelect();
                }
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // ===== AUTHENTICATION =====
        function initAuth() {
            // Check if user is logged in
            const userData = localStorage.getItem('user');
            const token = localStorage.getItem('token');
            
            if (userData && token) {
                try {
                    currentUser = JSON.parse(userData);
                    showPage('dashboardPage');
                    updateUserInfo();
                    initData();
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    showPage('authPage');
                }
            } else {
                showPage('authPage');
            }

            // Form toggle
            document.getElementById('showRegister').addEventListener('click', function(e) {
                e.preventDefault();
                toggleAuthForms('register');
            });

            document.getElementById('showLogin').addEventListener('click', function(e) {
                e.preventDefault();
                toggleAuthForms('login');
            });

            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Register form submission
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegister();
            });

            // Logout - ADD EVENT LISTENER PROPERLY
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
        }

        function toggleAuthForms(formType) {
            if (formType === 'register') {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
                document.getElementById('loginTitle').style.display = 'none';
                document.getElementById('registerTitle').style.display = 'block';
                document.getElementById('loginText').style.display = 'none';
                document.getElementById('registerText').style.display = 'block';
                document.getElementById('showRegister').style.display = 'none';
                document.getElementById('showLogin').style.display = 'inline';
            } else {
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerTitle').style.display = 'none';
                document.getElementById('loginTitle').style.display = 'block';
                document.getElementById('registerText').style.display = 'none';
                document.getElementById('loginText').style.display = 'block';
                document.getElementById('showLogin').style.display = 'none';
                document.getElementById('showRegister').style.display = 'inline';
            }
        }

        function handleLogin() {
            alert("Login clicked");
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            fetch('http://localhost:3000/api/auth/login', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ email, password })
            })
            .then(res => res.json())
            .then(data => {
                if (!data.token) {
                    showToast(data.error || 'Login failed', 'error');
                    return;
                }

                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));

                currentUser = data.user;

                showToast('Login successful!', 'success');
                showPage('dashboardPage');
                updateUserInfo();
                generateMockData();
            })
            .catch(() => {
                showToast('Server error', 'error');
            });
        }


        function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || password.length < 6) {
                showToast('Please fill all fields correctly', 'error');
                return;
            }

            //  CALL REGISTER API
            fetch('http://localhost:3000/api/auth/register', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    password: password
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                    return;
                }

                

                showToast('Registration successful! Please login.', 'success');

                // switch to login form
                toggleAuthForms('login');

                // clear form
                document.getElementById('regName').value = '';
                document.getElementById('regEmail').value = '';
                document.getElementById('regPassword').value = '';
            })
            .catch(() => {
                showToast('Server error. Try again.', 'error');
            });
        }


       function handleLogout() {
            // Clear all user data
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            localStorage.removeItem('projects');
            localStorage.removeItem('tasks');
            localStorage.removeItem('notificationSettings');
            localStorage.removeItem('privacySettings');
            localStorage.removeItem('theme');
            localStorage.removeItem('primaryColor');
            localStorage.removeItem('compactView');
            
            // Reset all global variables
            currentUser = null;
            projects = [];
            tasks = [];
            teamMembers = [];
            activities = [];
            notifications = [];
            analytics = {};
            calendar = null;
            
            // Close any open modals
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
            
            // Close notifications panel
            document.getElementById('notificationsPanel').classList.remove('active');
            
            // Show auth page
            showPage('authPage');
            
            // Clear any existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            // Show logout message
            showToast('Logged out successfully', 'success');
            
            // Reset auth forms to login state
            toggleAuthForms('login');
            document.getElementById('loginForm').reset();
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            document.querySelectorAll('.user-name').forEach(el => {
                el.textContent = currentUser.name;
            });
            
            document.querySelectorAll('.user-email').forEach(el => {
                el.textContent = currentUser.email;
            });
            
            document.querySelectorAll('.user-avatar').forEach(el => {
                el.textContent = currentUser.avatar;
            });
        }

        // ===== DATA INITIALIZATION =====
        function initData() {
            generateMockData();
            updateDashboard();
            loadteamMembers();
            loadTeamMembers();
            renderTaskBoard();
            loadNotifications();
            updateActivityTimeline();
            initAnalytics();

                        // Sync with backend every 30 seconds
            setInterval(syncProjectsWithBackend, 30000);
        }



        function generateMockData() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                showToast('Not authenticated', 'error');
                return;
            }


             // First try to load projects from localStorage
            const savedProjects = localStorage.getItem('projects');
            if (savedProjects) {
                projects = JSON.parse(savedProjects);
                updateDashboard();
                renderAllProjects();
                return; // Skip API call if we have cached projects
            }

            /* =========================
            FETCH PROJECTS (REAL)
            ========================= */
            fetch('http://localhost:3000/api/projects', {
                headers: {
                    "Authorization": "Bearer " + token
                }
            })
            .then(res => {
                if (!res.ok) throw new Error('Failed to fetch projects');
                return res.json();
            })
            .then(data => {
                // Convert backend projects to frontend format
                projects = data.map(project => ({
                    id: project._id,
                    name: project.name,
                    description: project.description || '',
                    color: project.color || '#6366f1',
                    progress: 0,
                    tasks: 0,
                    members: 1,
                    daysLeft: project.deadline
                        ? Math.max(Math.ceil((new Date(project.deadline) - new Date()) / (1000 * 60 * 60 * 24)), 0)
                        : 30
                }));
                

                localStorage.setItem('projects', JSON.stringify(projects));

                updateDashboard();
                renderAllProjects();
            })
            .catch(() => {
                showToast('Failed to load projects', 'error');
                const savedProjects = localStorage.getItem('projects');
                if (savedProjects) {
                    projects = JSON.parse(savedProjects);
                    updateDashboard();
                    renderAllProjects();
                }
            });
            

            /* =========================
            ACTIVITIES (UI MOCK  OK)
            ========================= */
            const activityTypes = ['created', 'updated', 'completed', 'commented', 'assigned'];
            const activitySubjects = ['task', 'project', 'comment', 'milestone'];

            activities = Array.from({ length: 8 }, (_, i) => {
                const type = activityTypes[Math.floor(Math.random() * activityTypes.length)];
                const subject = activitySubjects[Math.floor(Math.random() * activitySubjects.length)];
                const task = tasks[Math.floor(Math.random() * tasks.length)];
                const user = ['John Doe', 'Sarah Smith', 'Mike Johnson', 'Alex Chen'][Math.floor(Math.random() * 4)];
                const timeAgo = `${Math.floor(Math.random() * 24) + 1} hours ago`;

                return {
                    id: i + 1,
                    user,
                    type,
                    subject,
                    task: task ? task.title : '',
                    project: task && task.project ? task.project.name : '',
                    time: timeAgo,
                    icon: getActivityIcon(type)
                };
            });

            /* =========================
            NOTIFICATIONS (UI MOCK)
            ========================= */
            notifications = [
                { id: 1, message: 'New task created', time: '2 hours ago', read: false, type: 'task' },
                { id: 2, message: 'Task completed', time: '4 hours ago', read: false, type: 'completion' }
            ];

            /* =========================
            TEAM MEMBERS (UI MOCK)
            ========================= */
            const memberNames = [
                'John Doe', 'Sarah Smith', 'Mike Johnson', 'Alex Chen',
                'Emma Wilson', 'David Brown', 'Lisa Taylor', 'Robert Davis'
            ];

            const memberRoles = ['Project Manager', 'Developer', 'Designer', 'QA Engineer', 'Product Owner'];
            const memberStatuses = ['active', 'active', 'active', 'active', 'away', 'offline'];

            teamMembers = memberNames.map((name, index) => {
                const firstName = name.split(' ')[0];
                const lastName = name.split(' ')[1];

                return {
                    id: index + 1,
                    name,
                    email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@company.com`,
                    avatar: firstName.charAt(0) + lastName.charAt(0),
                    role: memberRoles[Math.floor(Math.random() * memberRoles.length)],
                    status: memberStatuses[Math.floor(Math.random() * memberStatuses.length)],
                    joinedDate: new Date(),
                    tasksCompleted: Math.floor(Math.random() * 50) + 10,
                    currentTasks: Math.floor(Math.random() * 8) + 2,
                    performance: Math.floor(Math.random() * 30) + 70
                };
            });

            if (currentUser && !teamMembers.some(m => m.id === currentUser.id)) {
                teamMembers.unshift({
                    id: currentUser.id,
                    name: currentUser.name,
                    email: currentUser.email,
                    avatar: currentUser.avatar,
                    role: 'Project Manager',
                    status: 'active',
                    joinedDate: new Date(),
                    tasksCompleted: 45,
                    currentTasks: 8,
                    performance: 95
                });
            }
        }


        function getActivityIcon(type) {
            const icons = {
                'created': 'plus-circle',
                'updated': 'edit',
                'completed': 'check-circle',
                'commented': 'comment',
                'assigned': 'user-plus'
            };
            return icons[type] || 'info-circle';
        }

        // ===== DASHBOARD FUNCTIONS =====
        function updateDashboard() {
            updateStats();
            renderRecentProjects();
            updateActivityTimeline();
        }

        function updateStats() {
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const pendingTasks = tasks.filter(t => t.status !== 'completed').length;
            const overdueTasks = tasks.filter(t => 
                t.dueDate && new Date(t.dueDate) < new Date() && t.status !== 'completed'
            ).length;
            const totalMembers = teamMembers.length;
            const activeMembers = teamMembers.filter(m => m.status === 'active').length;
            
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('pendingTasks').textContent = pendingTasks;
            document.getElementById('totalProjects').textContent = projects.length;
            document.getElementById('teamMembers').textContent = 8;
            
            // Update badges
            document.querySelectorAll('#projectsBadge, #projectsBadge2, #projectsBadge3').forEach(el => {
                el.textContent = projects.length;
            });
            
            document.querySelectorAll('#tasksBadge, #tasksBadge2, #tasksBadge3').forEach(el => {
                el.textContent = tasks.length;
            });
            
            // Update notification badge
            const unreadCount = notifications.filter(n => !n.read).length;
            document.getElementById('notificationBadge').style.display = unreadCount > 0 ? 'block' : 'none';
        }

        function renderRecentProjects() {
            const container = document.getElementById('recentProjectsGrid');
            if (!container) return;
            
            const recentProjects = projects.slice(0, 4);
            
            if (recentProjects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3 class="empty-state-title">No Projects Yet</h3>
                        <p class="empty-state-description">Create your first project to get started</p>
                        <button class="btn btn-primary" onclick="showModal('newProjectModal')">
                            <i class="fas fa-plus"></i> Create Project
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentProjects.map(project => `
                <div class="project-card" onclick="viewProject(${project.id})">
                    <div class="project-header">
                        <div class="project-color" style="background: ${project.color};"></div>
                        <h3 class="project-title">${project.name}</h3>
                        <p class="project-description">${project.description.substring(0, 100)}${project.description.length > 100 ? '...' : ''}</p>
                    </div>
                    
                    <div class="project-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%;"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress</span>
                            <span>${project.progress}%</span>
                        </div>
                    </div>
                    
                    <div class="project-stats">
                        <div class="project-stat">
                            <div class="stat-number">${project.tasks}</div>
                            <div class="stat-label">Tasks</div>
                        </div>
                        <div class="project-stat">
                            <div class="stat-number">${project.members}</div>
                            <div class="stat-label">Members</div>
                        </div>
                        <div class="project-stat">
                            <div class="stat-number">${project.daysLeft}</div>
                            <div class="stat-label">Days Left</div>
                        </div>
                    </div>
                    
                    <div class="member-list">
                        ${Array.from({length: Math.min(3, project.members)}, (_, i) => `
                            <div class="member-avatar" style="background: ${['#fbbf24', '#10b981', '#8b5cf6'][i % 3]}">
                                ${String.fromCharCode(65 + i)}
                            </div>
                        `).join('')}
                        ${project.members > 3 ? 
                            `<div class="member-avatar more">+${project.members - 3}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderAllProjects() {
            const container = document.getElementById('allProjectsGrid');
            if (!container) return;
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3 class="empty-state-title">No Projects Found</h3>
                        <p class="empty-state-description">Create your first project to get started</p>
                        <button class="btn btn-primary" onclick="showModal('newProjectModal')">
                            <i class="fas fa-plus"></i> Create Project
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = projects.map(project => {
                // Calculate days left if not already calculated
                const daysLeft = project.daysLeft || 
                    (project.deadline 
                        ? Math.max(Math.ceil((new Date(project.deadline) - new Date()) / (1000 * 60 * 60 * 24)), 0)
                        : 30);
                
                return `
                    <div class="project-card" onclick="viewProject('${project.id}')">
                        <div class="project-header">
                            <div class="project-color" style="background: ${project.color || '#6366f1'};"></div>
                            <h3 class="project-title">${project.name}</h3>
                            <p class="project-description">${project.description.substring(0, 100)}${project.description.length > 100 ? '...' : ''}</p>
                        </div>
                        
                        <div class="project-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${project.progress || 0}%;"></div>
                            </div>
                            <div class="progress-text">
                                <span>Progress</span>
                                <span>${project.progress || 0}%</span>
                            </div>
                        </div>
                        
                        <div class="project-stats">
                            <div class="project-stat">
                                <div class="stat-number">${project.tasks || 0}</div>
                                <div class="stat-label">Tasks</div>
                            </div>
                            <div class="project-stat">
                                <div class="stat-number">${project.members || 1}</div>
                                <div class="stat-label">Members</div>
                            </div>
                            <div class="project-stat">
                                <div class="stat-number">${daysLeft}</div>
                                <div class="stat-label">Days Left</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                showToast(`Viewing ${project.name}`, 'success');
                // In a real app, you would show project details
            }
        }


        function initAnalytics() {
            // Wait a bit for DOM to be ready
            setTimeout(() => {
                createAnalyticsCharts();
                updateAnalyticsMetrics();
                updateTopPerformers();
            }, 100);
        }


        function createAnalyticsCharts() {
            // Task Completion Chart
            const taskCompletionCtx = document.getElementById('taskCompletionChart');
            if (taskCompletionCtx) {
                analyticsCharts.taskCompletion = new Chart(taskCompletionCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                        datasets: [{
                            label: 'Tasks Completed',
                            data: [12, 19, 15, 25, 22, 30, 28],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
            }

            // Project Progress Chart
            const projectProgressCtx = document.getElementById('projectProgressChart');
            if (projectProgressCtx) {
                analyticsCharts.projectProgress = new Chart(projectProgressCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'In Progress', 'Planning', 'On Hold'],
                        datasets: [{
                            data: [25, 40, 20, 15],
                            backgroundColor: [
                                '#10b981',
                                '#6366f1',
                                '#f59e0b',
                                '#9ca3af'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }

            // Team Performance Chart
            const teamPerformanceCtx = document.getElementById('teamPerformanceChart');
            if (teamPerformanceCtx) {
                const topPerformers = [...teamMembers]
                    .sort((a, b) => b.performance - a.performance)
                    .slice(0, 5);
                
                analyticsCharts.teamPerformance = new Chart(teamPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: topPerformers.map(m => m.name.split(' ')[0]),
                        datasets: [{
                            label: 'Performance %',
                            data: topPerformers.map(m => m.performance),
                            backgroundColor: '#6366f1',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }

            // Task Distribution Chart
            const taskDistributionCtx = document.getElementById('taskDistributionChart');
            if (taskDistributionCtx) {
                const statusCounts = {
                    'todo': tasks.filter(t => t.status === 'todo').length,
                    'in-progress': tasks.filter(t => t.status === 'in-progress').length,
                    'review': tasks.filter(t => t.status === 'review').length,
                    'completed': tasks.filter(t => t.status === 'completed').length
                };
                
                analyticsCharts.taskDistribution = new Chart(taskDistributionCtx, {
                    type: 'polarArea',
                    data: {
                        labels: ['To Do', 'In Progress', 'Review', 'Completed'],
                        datasets: [{
                            data: [
                                statusCounts.todo,
                                statusCounts['in-progress'],
                                statusCounts.review,
                                statusCounts.completed
                            ],
                            backgroundColor: [
                                '#9ca3af',
                                '#6366f1',
                                '#f59e0b',
                                '#10b981'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }
        }

        function updateAnalyticsMetrics() {
            const productivityMetrics = document.getElementById('productivityMetrics');
            if (!productivityMetrics) return;
            
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            const avgCompletionTime = 3.2; // Mock data in days
            
            productivityMetrics.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 20px;">
                    <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">${completionRate}%</div>
                        <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">Completion Rate</div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">${avgCompletionTime}</div>
                        <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">Avg. Days per Task</div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">${completedTasks}</div>
                        <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">Tasks Completed</div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 16px; border-radius: var(--radius-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">${tasks.length}</div>
                        <div style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">Total Tasks</div>
                    </div>
                </div>
            `;
        }

        function updateActivityTimeline() {
            const container = document.getElementById('activityTimeline');
            if (!container) return;
            
            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <p><strong>${activity.user}</strong> ${activity.type} ${activity.subject} in <strong>${activity.project}</strong></p>
                        <span class="activity-time">${activity.time}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateAnalytics() {
            const period = document.getElementById('analyticsPeriod').value;
            showToast(`Analytics updated for ${period}`, 'success');
            
            // In a real app, you would fetch new data based on the selected period
            // For now, we'll just update the charts with new random data
            if (analyticsCharts.taskCompletion) {
                const newData = Array.from({length: 7}, () => Math.floor(Math.random() * 30) + 10);
                analyticsCharts.taskCompletion.data.datasets[0].data = newData;
                analyticsCharts.taskCompletion.update();
            }
        }

        function updateTopPerformers() {
            const topPerformers = document.getElementById('topPerformers');
            if (!topPerformers) return;
            
            const performers = [...teamMembers]
                .sort((a, b) => b.performance - a.performance)
                .slice(0, 5);
            
            topPerformers.innerHTML = performers.map((member, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--gray-200);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-weight: 600; color: var(--gray-500);">#${index + 1}</span>
                        <div style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;">
                            ${member.avatar}
                        </div>
                        <div>
                            <div style="font-weight: 500; color: var(--gray-800);">${member.name.split(' ')[0]}</div>
                            <div style="font-size: 12px; color: var(--gray-500);">${member.role}</div>
                        </div>
                    </div>
                    <div style="font-weight: 600; color: var(--success);">${member.performance}%</div>
                </div>
            `).join('');
        }


        // ===== TASK MANAGEMENT =====
        function renderTaskBoard() {
            const statusColumns = {
                'todo': document.getElementById('todoList'),
                'in-progress': document.getElementById('inProgressList'),
                'review': document.getElementById('reviewList'),
                'completed': document.getElementById('completedList')
            };

            const statusCounts = {
                'todo': 0,
                'in-progress': 0,
                'review': 0,
                'completed': 0
            };

            // Clear all columns
            Object.values(statusColumns).forEach(column => {
                if (column) column.innerHTML = '';
            });

            // Sort tasks by due date (ascending)
            const sortedTasks = [...tasks].sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

            // Add tasks to columns
            sortedTasks.forEach(task => {
                const column = statusColumns[task.status];
                if (column) {
                    statusCounts[task.status]++;
                    column.appendChild(createTaskElement(task));
                }
            });

            // Update counts
            document.getElementById('todoCount').textContent = statusCounts.todo;
            document.getElementById('inProgressCount').textContent = statusCounts['in-progress'];
            document.getElementById('reviewCount').textContent = statusCounts.review;
            document.getElementById('completedCount').textContent = statusCounts.completed;

            // Show empty states
            Object.entries(statusColumns).forEach(([status, column]) => {
                if (statusCounts[status] === 0 && column) {
                    column.innerHTML = `
                        <div class="empty-state" style="padding: 20px; text-align: center;">
                            <i class="fas fa-tasks" style="font-size: 32px; color: var(--gray-300); margin-bottom: 8px;"></i>
                            <p style="color: var(--gray-500); font-size: 12px;">No tasks</p>
                        </div>
                    `;
                }
            });
        }

        function createTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-item';
            taskElement.draggable = true;
            taskElement.dataset.taskId = task.id;
            
            const dueDate = task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'No deadline';
            const priorityClass = `priority-${task.priority}`;
            
            taskElement.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-priority ${priorityClass}">${task.priority}</div>
                </div>
                <div class="task-description">${task.description.substring(0, 60)}${task.description.length > 60 ? '...' : ''}</div>
                <div class="task-footer">
                    <span class="task-project">${task.projectName}</span>
                    <span class="task-due">
                        <i class="far fa-calendar"></i> ${dueDate}
                    </span>
                </div>
            `;
            
            taskElement.addEventListener('dragstart', dragStart);
            taskElement.addEventListener('click', () => showTaskDetail(task.id));
            
            return taskElement;
        }

        function showTaskDetail(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const project = projects.find(p => p.id === task.projectId) || { name: 'Unknown Project' };
            const dueDate = task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'Not set';
            const createdDate = new Date(task.createdAt).toLocaleDateString();
            
            document.getElementById('taskDetailTitle').textContent = task.title;
            document.getElementById('taskDetailContent').innerHTML = `
                <div style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 8px; color: var(--gray-700);">Description</h4>
                        <p style="color: var(--gray-600);">${task.description}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Project</h4>
                            <p style="color: var(--gray-600);">${project.name}</p>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Status</h4>
                            <span class="task-priority priority-${task.priority}" style="display: inline-block;">
                                ${task.status.charAt(0).toUpperCase() + task.status.slice(1)}
                            </span>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Priority</h4>
                            <span class="task-priority ${task.priority === 'high' ? 'priority-high' : task.priority === 'medium' ? 'priority-medium' : 'priority-low'}" style="display: inline-block;">
                                ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                            </span>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Assigned To</h4>
                            <p style="color: var(--gray-600);">${task.assignedTo}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Due Date</h4>
                            <p style="color: var(--gray-600);">
                                <i class="far fa-calendar"></i> ${dueDate}
                            </p>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 8px; color: var(--gray-700);">Created</h4>
                            <p style="color: var(--gray-600);">${createdDate}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 32px; padding-top: 20px; border-top: 1px solid var(--gray-200);">
                        <button class="btn btn-primary" onclick="editTask(${task.id})" style="margin-right: 12px;">
                            <i class="fas fa-edit"></i> Edit Task
                        </button>
                        <button class="btn btn-outline" onclick="deleteTask(${task.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
            
            showModal('taskDetailModal');
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskProjectSelect').value = task.projectId;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskDeadline').value = task.dueDate ? new Date(task.dueDate).toISOString().split('T')[0] : '';
            
            hideModal('taskDetailModal');
            showModal('newTaskModal');
            
            // Change modal title and button
            document.querySelector('#newTaskModal .modal-header h3').textContent = 'Edit Task';
            document.querySelector('#newTaskModal button[type="submit"]').textContent = 'Update Task';
            
            // Store task id for update
            const form = document.getElementById('taskForm');
            form.dataset.editingTaskId = taskId;
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                renderTaskBoard();
                updateStats();
                hideModal('taskDetailModal');
                showToast('Task deleted successfully', 'success');
            }
        }

        // ===== DRAG AND DROP =====
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function dragStart(ev) {
            ev.dataTransfer.setData("text", ev.target.dataset.taskId);
            ev.target.style.opacity = "0.4";
        }

        function drop(ev) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData("text");
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            
            if (taskElement) {
                const newStatus = ev.target.closest('.task-column').id.replace('Column', '');
                updateTaskStatus(parseInt(taskId), newStatus);
                
                // Reset opacity
                taskElement.style.opacity = "1";
            }
        }

        function updateTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.status !== newStatus) {
                task.status = newStatus;
                task.completed = newStatus === 'completed';
                
                // Add activity
                activities.unshift({
                    id: activities.length + 1,
                    user: currentUser ? currentUser.name : 'You',
                    type: 'updated',
                    subject: 'task',
                    task: task.title,
                    project: task.projectName,
                    time: 'Just now',
                    icon: 'edit'
                });
                
                renderTaskBoard();
                updateActivityTimeline();
                showToast(`Task moved to ${newStatus}`, 'success');
            }
        }

        function addTaskToColumn(status) {
            // Set the status in the form
            document.getElementById('taskStatus').value = status;
            showModal('newTaskModal');
        }

        // ===== PROJECT CREATION =====
        function populateProjectSelect() {
            const select = document.getElementById('taskProjectSelect');
            if (!select) return;
            
            // Clear existing options except the first one
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Add project options
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                select.appendChild(option);
            });
        }

        function createProject(e) {
            e.preventDefault();

            const token = localStorage.getItem('token');
            if (!token) {
                showToast('Session expired. Please login again.', 'error');
                showPage('authPage');
                return;
            }

            const name = document.getElementById('projectName').value.trim();
            const description = document.getElementById('projectDescription').value.trim();
            const color = document.getElementById('projectColor').value;
            const deadline = document.getElementById('projectDeadline')?.value;

            if (!name) {
                showToast('Please enter project name', 'error');
                return;
            }

            fetch('http://localhost:3000/api/projects', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ name, description, color, deadline })
            })
            .then(async res => {
                const data = await res.json();
                if (!res.ok) throw data;
                return data;
            })
            .then(data => {
                //  Extract project from response
                const project = data.project;
                
                if (!project || !project._id) {
                    showToast('Invalid project response', 'error');
                    return;
                }

                //  Convert backend project  frontend format
                const frontendProject = {
                    id: project._id,
                    name: project.name,
                    description: project.description || '',
                    color: project.color || '#6366f1',
                    progress: 0,
                    tasks: 0,
                    members: 1,
                    daysLeft: project.deadline
                        ? Math.max(
                            Math.ceil((new Date(project.deadline) - new Date()) / (1000 * 60 * 60 * 24)),
                            0
                        )
                        : 30
                };

                //  Add to projects array
                projects.unshift(frontendProject); // Add to beginning of array

                localStorage.setItem('projects', JSON.stringify(projects));

                //  Update UI
                renderAllProjects();
                renderRecentProjects(); // Also update recent projects on dashboard
                updateDashboard();

                //  Reset form and close modal
                document.getElementById('projectForm').reset();
                hideModal('newProjectModal');

                showToast('Project created successfully!', 'success');
            })
            .catch(err => {
                console.error('Create Project Error:', err);
                showToast(err.message || 'Server error. Project not created.', 'error');
            });
        }




        function createTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const projectId = parseInt(document.getElementById('taskProjectSelect').value);
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;
            const deadline = document.getElementById('taskDeadline').value;
            
            if (!title) {
                showToast('Please enter task title', 'error');
                return;
            }
            
            const project = projects.find(p => p.id === projectId);
            
            // Check if editing existing task
            const editingTaskId = e.target.dataset.editingTaskId;
            if (editingTaskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(t => t.id === parseInt(editingTaskId));
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        description,
                        projectId,
                        projectName: project ? project.name : 'Unknown Project',
                        priority,
                        status,
                        dueDate: deadline ? new Date(deadline) : null
                    };
                    
                    showToast('Task updated successfully!', 'success');
                }
                
                // Clear editing state
                delete e.target.dataset.editingTaskId;
                document.querySelector('#newTaskModal .modal-header h3').textContent = 'Create New Task';
                document.querySelector('#newTaskModal button[type="submit"]').textContent = 'Create Task';
            } else {
                // Create new task
                const newTask = {
                    id: tasks.length + 1,
                    title: title,
                    description: description,
                    projectId: projectId,
                    projectName: project ? project.name : 'Unknown Project',
                    status: status,
                    priority: priority,
                    assignedTo: currentUser ? currentUser.name : 'John Doe',
                    dueDate: deadline ? new Date(deadline) : null,
                    createdAt: new Date(),
                    completed: status === 'completed'
                };
                
                tasks.push(newTask);
                showToast('Task created successfully!', 'success');
                
                // Add activity
                activities.unshift({
                    id: activities.length + 1,
                    user: currentUser ? currentUser.name : 'You',
                    type: 'created',
                    subject: 'task',
                    task: title,
                    project: project ? project.name : 'Unknown Project',
                    time: 'Just now',
                    icon: 'plus-circle'
                });
            }
            
            // Reset form
            document.getElementById('taskForm').reset();
            
            // Hide modal
            hideModal('newTaskModal');
            
            // Update dashboard and task board
            updateDashboard();
            renderTaskBoard();
            updateActivityTimeline();
            
            // Update calendar if it exists
            if (calendar) {
                calendar.refetchEvents();
            }
        }

        // ===== CALENDAR FUNCTIONS =====
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) return;
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: getCalendarEvents(),
                eventClick: function(info) {
                    const taskId = info.event.extendedProps.taskId;
                    if (taskId) {
                        showTaskDetail(taskId);
                    }
                },
                dateClick: function(info) {
                    document.getElementById('taskDeadline').value = info.dateStr;
                    showModal('newTaskModal');
                },
                eventContent: function(arg) {
                    const priority = arg.event.extendedProps.priority;
                    const priorityColor = priority === 'high' ? '#ef4444' : 
                                        priority === 'medium' ? '#f59e0b' : '#10b981';
                    
                    return {
                        html: `
                            <div style="display: flex; align-items: center; padding: 2px;">
                                <div style="width: 8px; height: 8px; background: ${priorityColor}; border-radius: 50%; margin-right: 6px;"></div>
                                <div style="font-size: 0.85em; overflow: hidden; text-overflow: ellipsis;">
                                    ${arg.event.title}
                                </div>
                            </div>
                        `
                    };
                }
            });
            
            calendar.render();
        }

        function getCalendarEvents() {
            return tasks
                .filter(task => task.dueDate)
                .map(task => {
                    const priorityColor = task.priority === 'high' ? '#ef4444' : 
                                        task.priority === 'medium' ? '#f59e0b' : '#10b981';
                    
                    return {
                        title: task.title,
                        start: task.dueDate,
                        color: priorityColor,
                        textColor: '#ffffff',
                        extendedProps: {
                            taskId: task.id,
                            priority: task.priority,
                            project: task.projectName
                        }
                    };
                });
        }
        // ===== PROJECT SYNC FUNCTIONS =====
        async function syncProjectsWithBackend() {
            const token = localStorage.getItem('token');
            if (!token) return;
            
            try {
                const response = await fetch('http://localhost:3000/api/projects', {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });
                
                if (!response.ok) throw new Error('Failed to sync');
                
                const data = await response.json();
                const backendProjects = data.map(project => ({
                    id: project._id,
                    name: project.name,
                    description: project.description || '',
                    color: project.color || '#6366f1',
                    progress: 0,
                    tasks: 0,
                    members: 1,
                    daysLeft: project.deadline
                        ? Math.max(Math.ceil((new Date(project.deadline) - new Date()) / (1000 * 60 * 60 * 24)), 0)
                        : 30
                }));
                
                // Merge local and backend projects, preferring backend data
                projects = [...backendProjects];
                localStorage.setItem('projects', JSON.stringify(projects));
                
                updateDashboard();
                renderAllProjects();
            } catch (error) {
                console.error('Sync failed, using cached data:', error);
            }
        }

                // ===== TEAM FUNCTIONS =====
        function loadTeamMembers() {
            const container = document.getElementById('teamMembersGrid');
            if (!container) return;
            
            // This is just mock data - in a real app you would fetch from API
            if (!teamMembers || teamMembers.length === 0) {
                // Create some mock team members if none exist
                teamMembers = [
                    {
                        id: 1,
                        name: 'John Doe',
                        email: 'john@example.com',
                        avatar: 'JD',
                        role: 'Project Manager',
                        status: 'active',
                        joinedDate: new Date(),
                        tasksCompleted: 45,
                        currentTasks: 8,
                        performance: 95
                    },
                    {
                        id: 2,
                        name: 'Sarah Smith',
                        email: 'sarah@example.com',
                        avatar: 'SS',
                        role: 'Developer',
                        status: 'active',
                        joinedDate: new Date(),
                        tasksCompleted: 32,
                        currentTasks: 5,
                        performance: 88
                    }
                ];
            }
            
            if (teamMembers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="empty-state-title">No Team Members</h3>
                        <p class="empty-state-description">Add your first team member to get started</p>
                        <button class="btn btn-primary" onclick="showModal('addMemberModal')">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teamMembers.map(member => `
                <div class="team-member-card">
                    <div class="member-avatar-lg">${member.avatar}</div>
                    <h3 style="margin-bottom: 8px; color: var(--gray-900);">${member.name}</h3>
                    <div class="member-role">${member.role}</div>
                    <p style="color: var(--gray-500); font-size: 14px; margin-bottom: 16px;">${member.email}</p>
                    
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 20px;">
                        <span style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--gray-500);">
                            <i class="fas fa-circle" style="color: ${member.status === 'active' ? '#10b981' : member.status === 'away' ? '#f59e0b' : '#9ca3af'}; font-size: 8px;"></i>
                            ${member.status.charAt(0).toUpperCase() + member.status.slice(1)}
                        </span>
                        <span style="color: var(--gray-300);"></span>
                        <span style="font-size: 12px; color: var(--gray-500);">
                            Joined ${new Date(member.joinedDate).toLocaleDateString('en-US', {month: 'short', year: 'numeric'})}
                        </span>
                    </div>
                    
                    <div class="member-stats">
                        <div class="stat-item">
                            <div class="stat-value">${member.tasksCompleted}</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${member.currentTasks}</div>
                            <div class="stat-label">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${member.performance}%</div>
                            <div class="stat-label">Performance</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 8px;">
                        <button class="btn btn-outline btn-sm" style="flex: 1;" onclick="viewMemberProfile(${member.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-outline btn-sm" style="flex: 1;" onclick="messageMember(${member.id})">
                            <i class="fas fa-envelope"></i> Message
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Update team statistics
            updateTeamStatistics();
        }

        function updateTeamStatistics() {
            const totalMembers = teamMembers.length;
            const activeMembers = teamMembers.filter(m => m.status === 'active').length;
            const avgTasks = Math.round(teamMembers.reduce((sum, m) => sum + m.currentTasks, 0) / totalMembers);
            const avgPerformance = Math.round(teamMembers.reduce((sum, m) => sum + m.performance, 0) / totalMembers);
            
            document.getElementById('totalMembers').textContent = totalMembers;
            document.getElementById('activeMembers').textContent = activeMembers;
            document.getElementById('avgTasks').textContent = avgTasks;
            document.getElementById('completionRate').textContent = `${avgPerformance}%`;
        }

        function addTeamMember(e) {
            e.preventDefault();
            
            const name = document.getElementById('memberName').value;
            const email = document.getElementById('memberEmail').value;
            const role = document.getElementById('memberRole').value;
            const permissions = document.getElementById('memberPermissions').value;
            
            if (!name || !email || !role) {
                showToast('Please fill all required fields', 'error');
                return;
            }
            
            const firstName = name.split(' ')[0];
            const lastName = name.split(' ').slice(1).join(' ') || '';
            const avatar = firstName.charAt(0) + (lastName.charAt(0) || '');
            
            const newMember = {
                id: teamMembers.length + 1,
                name: name,
                email: email,
                avatar: avatar,
                role: role,
                status: 'active',
                joinedDate: new Date(),
                tasksCompleted: 0,
                currentTasks: 0,
                performance: 75,
                permissions: permissions
            };
            
            teamMembers.push(newMember);
            
            // Reset form
            document.getElementById('addMemberForm').reset();
            
            // Hide modal
            hideModal('addMemberModal');
            
            // Show success message
            showToast('Team member added successfully!', 'success');
            
            // Reload team members
            loadTeamMembers();
            
            // Update analytics if on analytics page
            if (analyticsCharts.teamPerformance) {
                updateAnalytics();
            }
        }

        function viewMemberProfile(memberId) {
            const member = teamMembers.find(m => m.id === memberId);
            if (member) {
                showToast(`Viewing ${member.name}'s profile`, 'success');
                // In a real app, you would show a member profile modal or page
            }
        }

        function messageMember(memberId) {
            const member = teamMembers.find(m => m.id === memberId);
            if (member) {
                showToast(`Messaging ${member.name}`, 'success');
                // In a real app, you would open a chat/messaging interface
            }
        }

        // ===== SETTINGS FUNCTIONS =====
        function initSettings() {
            showSettingsSection('profile');
            
            // Load current settings
            loadSettingsData();
            
            // Setup form submissions
            setupSettingsForms();
            
            // Setup delete account confirmation
            const confirmDeleteInput = document.getElementById('confirmDelete');
            if (confirmDeleteInput) {
                confirmDeleteInput.addEventListener('input', function() {
                    const deleteBtn = document.getElementById('deleteAccountBtn');
                    deleteBtn.disabled = this.value !== 'DELETE';
                });
            }
        }

        function showSettingsSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.settings-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            const section = document.getElementById(sectionId + 'Section');
            if (section) {
                section.classList.add('active');
            }
            
            // Add active class to clicked nav item
            const navItem = document.querySelector(`[onclick*="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
        }

        function loadSettingsData() {
            // Load user data into profile form
            if (currentUser) {
                document.getElementById('profileName').value = currentUser.name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profileTitle').value = currentUser.title || 'Project Manager';
            }
            
            // Load theme preference
            const theme = localStorage.getItem('theme') || 'light';
            selectTheme(theme);
            
            // Load other settings from localStorage
            loadFromLocalStorage();
        }

        function setupSettingsForms() {
            // Profile form
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveProfileSettings();
                });
            }
            
            // Account form
            const accountForm = document.getElementById('accountForm');
            if (accountForm) {
                accountForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveAccountSettings();
                });
            }
            
            // Notifications form
            const notificationsForm = document.getElementById('notificationsForm');
            if (notificationsForm) {
                notificationsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveNotificationSettings();
                });
            }
            
            // Appearance form
            const appearanceForm = document.getElementById('appearanceForm');
            if (appearanceForm) {
                appearanceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveAppearanceSettings();
                });
            }
            
            // Privacy form
            const privacyForm = document.getElementById('privacyForm');
            if (privacyForm) {
                privacyForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    savePrivacySettings();
                });
            }
            
            // Integrations form
            const integrationsForm = document.getElementById('integrationsForm');
            if (integrationsForm) {
                integrationsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveIntegrationSettings();
                });
            }
        }

        function saveProfileSettings() {
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const title = document.getElementById('profileTitle').value;
            const bio = document.getElementById('profileBio').value;
            
            // Update current user
            if (currentUser) {
                currentUser.name = name;
                currentUser.email = email;
                currentUser.title = title;
                localStorage.setItem('user', JSON.stringify(currentUser));
                updateUserInfo();
            }
            
            showToast('Profile updated successfully!', 'success');
        }

        function saveAccountSettings() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword) {
                showToast('Please enter your current password', 'error');
                return;
            }
            
            if (newPassword && newPassword.length < 8) {
                showToast('New password must be at least 8 characters', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }
            
            // In a real app, you would verify current password with backend
            // For demo purposes, we'll just show success
            showToast('Password updated successfully!', 'success');
            document.getElementById('accountForm').reset();
        }

        function saveNotificationSettings() {
            // Get all notification settings
            const settings = {
                emailTaskAssignments: document.getElementById('emailTaskAssignments').checked,
                emailTaskUpdates: document.getElementById('emailTaskUpdates').checked,
                emailComments: document.getElementById('emailComments').checked,
                emailProjectUpdates: document.getElementById('emailProjectUpdates').checked,
                pushDesktop: document.getElementById('pushDesktop').checked,
                pushSound: document.getElementById('pushSound').checked
            };
            
            // Save to localStorage
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
            showToast('Notification preferences saved!', 'success');
        }

        function resetNotificationSettings() {
            // Reset to default settings
            const defaultSettings = {
                emailTaskAssignments: true,
                emailTaskUpdates: true,
                emailComments: true,
                emailProjectUpdates: false,
                pushDesktop: true,
                pushSound: false
            };
            
            // Update checkboxes
            document.getElementById('emailTaskAssignments').checked = defaultSettings.emailTaskAssignments;
            document.getElementById('emailTaskUpdates').checked = defaultSettings.emailTaskUpdates;
            document.getElementById('emailComments').checked = defaultSettings.emailComments;
            document.getElementById('emailProjectUpdates').checked = defaultSettings.emailProjectUpdates;
            document.getElementById('pushDesktop').checked = defaultSettings.pushDesktop;
            document.getElementById('pushSound').checked = defaultSettings.pushSound;
            
            showToast('Notification settings reset to default', 'success');
        }

        function selectTheme(theme) {
            // Remove active class from all theme options
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to selected theme
            const themeOption = document.querySelector(`.theme-${theme}`);
            if (themeOption) {
                themeOption.classList.add('active');
            }
            
            // Save theme preference
            localStorage.setItem('theme', theme);
            
            // Apply theme to body
            document.body.setAttribute('data-theme', theme);
        }

        function selectColor(element, targetInputId) {
            // Remove active class from all color options in the same picker
            element.parentElement.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Add active class to clicked option
            element.classList.add('active');
            
            // Update color input if exists
            const colorInput = document.getElementById(targetInputId);
            if (colorInput) {
                colorInput.value = element.dataset.color;
            }
            
            // Update primary color CSS variable
            const color = element.dataset.color;
            document.documentElement.style.setProperty('--primary', color);
            
            // Save color preference
            localStorage.setItem('primaryColor', color);
        }

        function saveAppearanceSettings() {
            const compactView = document.getElementById('compactView').checked;
            
            // Save settings
            localStorage.setItem('compactView', compactView);
            
            // Apply compact view
            if (compactView) {
                document.body.classList.add('compact-view');
            } else {
                document.body.classList.remove('compact-view');
            }
            
            showToast('Appearance settings saved!', 'success');
        }

        function resetAppearanceSettings() {
            // Reset to default theme
            selectTheme('light');
            
            // Reset color to default
            const defaultColor = '#6366f1';
            document.documentElement.style.setProperty('--primary', defaultColor);
            localStorage.setItem('primaryColor', defaultColor);
            
            // Reset compact view
            document.getElementById('compactView').checked = false;
            document.body.classList.remove('compact-view');
            localStorage.setItem('compactView', false);
            
            // Reset color picker
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === defaultColor) {
                    opt.classList.add('active');
                }
            });
            
            showToast('Appearance settings reset to default', 'success');
        }

        function savePrivacySettings() {
            const usageAnalytics = document.getElementById('usageAnalytics').checked;
            const crashReports = document.getElementById('crashReports').checked;
            const profileVisibility = document.getElementById('profileVisibility').value;
            const activitySharing = document.getElementById('activitySharing').value;
            
            const settings = {
                usageAnalytics,
                crashReports,
                profileVisibility,
                activitySharing
            };
            
            localStorage.setItem('privacySettings', JSON.stringify(settings));
            showToast('Privacy settings saved!', 'success');
        }

        function downloadData() {
            showToast('Preparing your data download...', 'success');
            // In a real app, this would generate and download a data file
            setTimeout(() => {
                showToast('Data download ready!', 'success');
            }, 1500);
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all your data? This cannot be undone.')) {
                // Clear localStorage except for user data
                const userData = localStorage.getItem('user');
                localStorage.clear();
                if (userData) {
                    localStorage.setItem('user', userData);
                }
                
                showToast('Data cleared successfully!', 'success');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        function saveIntegrationSettings() {
            showToast('Integration settings saved!', 'success');
        }

        function connectService(service) {
            showToast(`Connecting ${service}...`, 'success');
            // In a real app, this would initiate OAuth flow
        }

        function disconnectService(service) {
            if (confirm(`Are you sure you want to disconnect ${service}?`)) {
                showToast(`${service} disconnected`, 'success');
            }
        }

        function generateApiKey() {
            const apiKey = 'sk_live_' + Math.random().toString(36).substring(2) + Math.random().toString(36).substring(2);
            const apiKeyContainer = document.getElementById('apiKeyContainer');
            const apiKeyElement = document.getElementById('apiKey');
            
            if (apiKeyContainer && apiKeyElement) {
                apiKeyElement.textContent = apiKey;
                apiKeyContainer.style.display = 'block';
                showToast('API key generated!', 'success');
            }
        }

        function copyApiKey() {
            const apiKeyElement = document.getElementById('apiKey');
            if (apiKeyElement) {
                navigator.clipboard.writeText(apiKeyElement.textContent);
                showToast('API key copied to clipboard!', 'success');
            }
        }

        function deleteAccount() {
            const confirmText = document.getElementById('confirmDelete').value;
            if (confirmText !== 'DELETE') {
                showToast('Please type DELETE to confirm', 'error');
                return;
            }
            
            // In a real app, this would call backend API
            showToast('Account deletion initiated...', 'success');
            setTimeout(() => {
                localStorage.clear();
                showPage('authPage');
                showToast('Account deleted successfully', 'success');
            }, 2000);
        }

        function loadFromLocalStorage() {
            // Load notification settings
            const notificationSettings = JSON.parse(localStorage.getItem('notificationSettings'));
            if (notificationSettings) {
                Object.keys(notificationSettings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.checked = notificationSettings[key];
                    }
                });
            }
            
            // Load privacy settings
            const privacySettings = JSON.parse(localStorage.getItem('privacySettings'));
            if (privacySettings) {
                Object.keys(privacySettings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = privacySettings[key];
                        } else {
                            element.value = privacySettings[key];
                        }
                    }
                });
            }
            
            // Load compact view
            const compactView = localStorage.getItem('compactView') === 'true';
            if (compactView) {
                document.getElementById('compactView').checked = true;
                document.body.classList.add('compact-view');
            }
            
            // Load primary color
            const primaryColor = localStorage.getItem('primaryColor') || '#6366f1';
            document.documentElement.style.setProperty('--primary', primaryColor);
            
            // Update color picker
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === primaryColor) {
                    opt.classList.add('active');
                }
            });
        }

        // ===== SEARCH FUNCTIONALITY =====
        function handleSearch(e) {
            clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                performSearch();
            }, 300);
            
            if (e.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim().toLowerCase();
            
            const searchResults = document.getElementById('searchResults');
            const resultsList = document.getElementById('searchResultsList');
            const resultsCount = document.getElementById('searchResultsCount');
            
            if (!query) {
                searchResults.style.display = 'none';
                return;
            }
            
            // Search in projects
            const projectResults = projects.filter(project => 
                project.name.toLowerCase().includes(query) || 
                project.description.toLowerCase().includes(query)
            ).map(project => ({
                type: 'project',
                title: project.name,
                description: project.description,
                color: project.color,
                id: project.id
            }));
            
            // Search in tasks
            const taskResults = tasks.filter(task => 
                task.title.toLowerCase().includes(query) || 
                task.description.toLowerCase().includes(query) ||
                task.projectName.toLowerCase().includes(query)
            ).map(task => ({
                type: 'task',
                title: task.title,
                description: task.description,
                status: task.status,
                priority: task.priority,
                id: task.id
            }));
            
            const allResults = [...projectResults, ...taskResults];
            
            if (allResults.length === 0) {
                resultsList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <div class="empty-state-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="empty-state-title">No results found</h3>
                        <p class="empty-state-description">Try different search terms</p>
                    </div>
                `;
            } else {
                resultsList.innerHTML = allResults.map(result => `
                    <div class="search-result-item" onclick="openSearchResult('${result.type}', ${result.id})">
                        <div>
                            <span class="search-result-type" style="background: ${result.type === 'project' ? result.color : (result.priority === 'high' ? '#ef4444' : result.priority === 'medium' ? '#f59e0b' : '#10b981')}">
                                ${result.type}
                            </span>
                            <h4 class="search-result-title">${result.title}</h4>
                            <p class="search-result-description">${result.description.substring(0, 100)}${result.description.length > 100 ? '...' : ''}</p>
                            <div class="search-result-meta">
                                ${result.type === 'task' ? `
                                    <span><i class="fas fa-flag"></i> ${result.priority}</span>
                                    <span><i class="fas fa-circle" style="color: ${result.status === 'completed' ? '#10b981' : result.status === 'in-progress' ? '#6366f1' : result.status === 'review' ? '#f59e0b' : '#9ca3af'}"></i> ${result.status}</span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            resultsCount.textContent = `${allResults.length} result${allResults.length !== 1 ? 's' : ''} found`;
            searchResults.style.display = 'block';
        }

        function openSearchResult(type, id) {
            if (type === 'project') {
                viewProject(id);
                showPage('projectsPage');
            } else if (type === 'task') {
                showTaskDetail(id);
            }
            
            // Hide search results
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('searchInput').value = '';
        }

        // ===== NOTIFICATIONS =====
        function loadNotifications() {
            const container = document.getElementById('notificationsList');
            if (!container) return;
            
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 20px; text-align: center;">
                        <i class="fas fa-bell-slash" style="font-size: 32px; color: var(--gray-300); margin-bottom: 8px;"></i>
                        <p style="color: var(--gray-500); font-size: 12px;">No notifications</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = notifications.map(notif => `
                <div class="notification-item ${!notif.read ? 'unread' : ''}" onclick="markNotificationAsRead(${notif.id})">
                    <div class="notification-content">
                        <p>${notif.message}</p>
                        <div class="notification-time">${notif.time}</div>
                    </div>
                </div>
            `).join('');
            
            // Update badge
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('active');
        }

        function markNotificationAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification && !notification.read) {
                notification.read = true;
                loadNotifications();
            }
        }

        function markAllNotificationsAsRead() {
            notifications.forEach(notification => {
                notification.read = true;
            });
            loadNotifications();
            showToast('All notifications marked as read', 'success');
        }

        // ===== UI UTILITIES =====
        function showToast(message, type = 'success') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            // Add to body
            document.body.appendChild(toast);
            
            // Show with animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function selectColor(element, targetInputId) {
            // Remove active class from all color options in the same picker
            element.parentElement.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Add active class to clicked option
            element.classList.add('active');
            
            // Update color input
            const colorInput = document.getElementById(targetInputId);
            if (colorInput) {
                colorInput.value = element.dataset.color;
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize authentication
            initAuth();
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModal(this.id);
                    }
                });
            });
            

            async function fetchProjects() {
                try {
                    const response = await fetch('http://localhost:3000/api/projects'); // Your API URL
                    const projects = await response.json();
                    const projectsGrid = document.querySelector('.projects-grid');
                    
                    if (projectsGrid && projects.length > 0) {
                        projectsGrid.innerHTML = ''; // Clear the hardcoded "Project Alpha" etc.
                        projects.forEach(project => {
                            projectsGrid.innerHTML += `
                                <div class="project-card">
                                    <div class="project-color" style="background: ${project.color || '#6366f1'}"></div>
                                    <h3 class="project-title">${project.title}</h3>
                                    <p class="project-description">${project.description}</p>
                                    <div class="project-stats">
                                        <div class="project-stat">
                                            <div class="stat-number">${project.tasksCount || 0}</div>
                                            <div class="stat-label">Tasks</div>
                                        </div>
                                    </div>
                                </div>`;
                        });
                    }
                } catch (err) {
                    console.error("Failed to load projects:", err);
                }
            }

            // Close notifications when clicking outside
            document.addEventListener('click', function(e) {
                const panel = document.getElementById('notificationsPanel');
                const btn = document.getElementById('notificationsBtn');
                
                if (panel.classList.contains('active') && 
                    !panel.contains(e.target) && 
                    !btn.contains(e.target)) {
                    panel.classList.remove('active');
                }
            });
            
            // Responsive sidebar
            window.addEventListener('resize', function() {
                const menuToggle = document.querySelector('.menu-toggle');
                if (window.innerWidth <= 768) {
                    menuToggle.style.display = 'block';
                } else {
                    menuToggle.style.display = 'none';
                    document.querySelector('.sidebar').classList.remove('active');
                }
            });
            
            document.querySelectorAll('[id*="logoutBtn"]').forEach(btn => {
                btn.addEventListener('click', handleLogout);
            });


            // Trigger initial resize check
            window.dispatchEvent(new Event('resize'));
        });

        // Make functions globally available
        window.showPage = showPage;
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.toggleSidebar = toggleSidebar;
        window.selectColor = selectColor;
        window.showSettingsSection = showSettingsSection;
        window.performSearch = performSearch;
        window.updateAnalyticsMetrics = updateAnalyticsMetrics;
        window.updateAnalytics = updateAnalytics;
        window.resetNotificationSettings = resetNotificationSettings;
        window.resetAppearanceSettings = resetAppearanceSettings;
        window.toggleNotifications = toggleNotifications;
        window.markAllNotificationsAsRead = markAllNotificationsAsRead;
        window.addTaskToColumn = addTaskToColumn;
        window.addTeamMember = addTeamMember;
        window.allowDrop = allowDrop;
        window.drop = drop;
    </script>
</body>
</html>